<!DOCTYPE HTML>

<html>
    <head>
        
            
                <title>dtoebe.com</title>
            
        

        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="generator" content="Hugo 0.16" />
        


        
        
            
                <meta name="description" content="Just the ramblings of a passionate programmer and Linux lover">
            
        

        
        <meta property="og:title" content="dtoebe.com" />
<meta property="og:description" content="Just the ramblings of a passionate programmer and Linux lover" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://dtoebe.com/" />


<meta property="og:updated_time" content="2016-09-21T13:08:39-07:00"/>









        
<meta itemprop="name" content="dtoebe.com">
<meta itemprop="description" content="Just the ramblings of a passionate programmer and Linux lover">


        

        

        
        
            
        

        
        
            <link rel="stylesheet" href="/css/google-font.css" />
            <link rel="stylesheet" href="/css/font-awesome.min.css" />
            <link rel="stylesheet" href="/css/main.css" />
            <link rel="stylesheet" href="/css/add-on.css" />
            <link rel="stylesheet" href="/css/monokai-sublime.css">
        

        

        
        
        
            
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-77817614-1', 'auto');
ga('send', 'pageview');
</script>

        
    </head>
    <body>

        
        <div id="wrapper">

    
    
<header id="header">
    
        <h1><a href="/">dtoebe.com</i></a></h1>
    

    <nav class="links">
        <ul>
            
                <li>
                    <a href="/post">
                        
                            <i class="fa fa-newspaper-o">&nbsp;</i>Blog
                    </a>
                </li>
            
                <li>
                    <a href="/categories">
                        Categories
                    </a>
                </li>
            
                <li>
                    <a href="/about">
                        About Me
                    </a>
                </li>
            
                <li>
                    <a href="/resume">
                        My Resume
                    </a>
                </li>
            
                <li>
                    <a href="/contact">
                        Contact Me
                    </a>
                </li>
            
        </ul>
    </nav>
    <nav class="main">
        <ul>
            
            <li id="share-nav" class="share-menu" style="display:none;">
                <a class="fa-share-alt" href="#share-menu">Share</a>
            </li>
            
            <li class="search">
                <a class="fa-search" href="#search">Search</a>
                <form id="search" method="get" action="//google.com/search">
                    <input type="text" name="q" placeholder="Search" />
                    <input type="hidden" name="q" value="site:http://dtoebe.com">
                </form>
            </li>
            <li class="menu">
                <a class="fa-bars" href="#menu">Menu</a>
            </li>
        </ul>
    </nav>
</header>


<section id="menu">

    
        <section>
            <form class="search" method="get" action="//google.com/search">
                <input type="text" name="q" placeholder="Search" />
                <input type="hidden" name="q" value="site:http://dtoebe.com">
            </form>
        </section>

    
        <section>
            <ul class="links">
                
                    <li>
                        <a href="/post">
                            <h3>
                                
                                    <i class="fa fa-newspaper-o">&nbsp;</i>
                                
                                Blog
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/categories">
                            <h3>
                                
                                Categories
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/about">
                            <h3>
                                
                                About Me
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/resume">
                            <h3>
                                
                                My Resume
                            </h3>
                        </a>
                    </li>
                
                    <li>
                        <a href="/contact">
                            <h3>
                                
                                Contact Me
                            </h3>
                        </a>
                    </li>
                
            </ul>
        </section>

    
        <section>
            <ul class="links">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                
                    
                

                
                    <li>
                        <a href="http://dtoebe.com/post/generating-datauri-images-with-go/"><p>Generating Data URI Images with GoLang</p></a>
                    </li>
                
                    <li>
                        <a href="http://dtoebe.com/post/simple_markdown_editor_in_go-qml/"><p>Write a simple Markdown editor with Go-QML</p></a>
                    </li>
                
            </ul>
        </section>

    
        
</section>

    
    <div id="main">
        
            <article class="post">
    <header>
    <div class="title">
        
            <h2><a href="http://dtoebe.com/post/generating-datauri-images-with-go/">Generating Data URI Images with GoLang</a></h2>
        
        
    </div>
    <div class="meta">
        
            
        

        <time class="published"
            datetime='2016-09-21'>
            September 21, 2016</time>
        <span class="author">Daniel Toebe</span>
        
            <p>5 minute read</p>
        
        
    </div>
</header>


    <section id="social-share">
        <ul class="icons">
            


<li><a href="//twitter.com/share?url=http%3a%2f%2fdtoebe.com%2fpost%2fgenerating-datauri-images-with-go%2f&text=Generating%20Data%20URI%20Images%20with%20GoLang&via=dtoebe" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
</a></li>


<li><a href="//plus.google.com/share?url=http%3a%2f%2fdtoebe.com%2fpost%2fgenerating-datauri-images-with-go%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
</a></li>


<li><a href="//www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fdtoebe.com%2fpost%2fgenerating-datauri-images-with-go%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
</a></li>


<li><a href="//reddit.com/submit?url=http%3a%2f%2fdtoebe.com%2fpost%2fgenerating-datauri-images-with-go%2f&title=Generating%20Data%20URI%20Images%20with%20GoLang" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
</a></li>


<li><a href="//www.linkedin.com/shareArticle?url=http%3a%2f%2fdtoebe.com%2fpost%2fgenerating-datauri-images-with-go%2f&title=Generating%20Data%20URI%20Images%20with%20GoLang" target="_blank" class="share-btn linkedin">
    <i class="fa fa-linkedin"></i>
    <p>LinkedIn</p>
</a></li>


<li><a href="//www.stumbleupon.com/submit?url=http%3a%2f%2fdtoebe.com%2fpost%2fgenerating-datauri-images-with-go%2f&title=Generating%20Data%20URI%20Images%20with%20GoLang" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
</a></li>


<li><a href="mailto:?subject=Check out this post by Daniel%20Toebe&body=http%3a%2f%2fdtoebe.com%2fpost%2fgenerating-datauri-images-with-go%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
</a></li>

        </ul>
    </section>
    

    <div id="content">
        

<h3 id="background">Background:</h3>

<p>This post came from one of the challenges set by my local <a href="https://www.meetup.com/Golang-Phoenix/events/233826496/">GoLang user group</a>.</p>

<blockquote>
<p>Problem 2:</p>

<p>Create an API with an endpoint that returns a PNG image containing the numeric representation of the number of times that endpoint has been hit.</p>
</blockquote>

<p>A data URI is basically a base64 bit encoded string of characters. You can encode many different types of data including binary data such as images.  Most modern browsers can decode data URIs automatically.</p>

<p>A great post on the basics of data URIs in web development is <a href="https://css-tricks.com/data-uris/">CSS-Tricks Data URI</a>. This is where I first learned about them. Reading that post you will hopefully see the nerd coolness that they are.</p>

<p>In reality with modern web technologies data URIs are becoming more and more impractical, because in reality they are 20% to 35% larger than their standard counterparts. You could gzip the data and for Go Lang there is a really good package from the New York Times: <a href="https://github.com/NYTimes/gziphandler">gziphandler</a>.</p>

<p>With that excessive size does come with a bonus. With typical HTTP requests for files such ad HTML, or images require an additional request to retrieve that file. That could be &ldquo;OK&rdquo; for mobile, or some sort of restricted device.</p>

<p>With a data URI, it can be sent over the request body as a simple string. Once the browser receives the string it will see a prefix:</p>

<pre><code>&quot;data:[&lt;mediatype][;base64],data&quot;
</code></pre>

<p><em>Source: <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Data_URIs">MDN Data URI</a>  NOTE: The MDN site is one of the best resources for learning client-side web technologies out there. It is VERY thorough.</em></p>

<p>As you can see from the Mozilla Developer Network Article you can encode many types of data for the browser.</p>

<ul>
<li>Plain Text <code>text/plain</code></li>
<li>HTML <code>text/html</code></li>
<li>JPG <code>image/jpg</code></li>
<li>PNG <code>image/png</code></li>
<li>GIF <code>image/gif</code></li>
</ul>

<p>And while dealing with <code>text</code> data types you don&rsquo;t even need to encode it, but <code>binary</code> types, like images, they will need to be encoded.</p>

<h3 id="getting-to-the-code">Getting to the code</h3>

<p>With this tutorial we will just focus on creating the data URI string to be sent.  At that point you can send it over some sort of API, or embedded in an HTML template. Also we will only use packages from the <code>std</code> libs.</p>

<p>To simplify things I am going to borrow most of the code for generating images from another one of my favorite sources <a href="https://www.socketloop.com/">SocketLoop</a>. SocketLoop always seems to have the answers for any golang question I have.  Specifically we will be using <a href="https://www.socketloop.com/tutorials/golang-save-image-to-png-jpeg-or-gif-format">this blog post</a>, a great resource on how to create images in golang.</p>

<p>Here are the imports</p>

<pre><code class="language-Go">
//main.go
package main

import (
    &quot;fmt&quot;
    &quot;image&quot;
    &quot;image/color&quot;
    &quot;image/draw&quot;
    &quot;image/png&quot;
    &quot;math/rand&quot;
    &quot;time&quot;
    &quot;bytes&quot;
    &quot;encoding/base64&quot;
)

</code></pre>

<p>You may be asking why the <code>math/rand</code>, and <code>time</code> packages. That&rsquo;s because per the <a href="https://www.socketloop.com/tutorials/golang-save-image-to-png-jpeg-or-gif-format">Socket Loop Tutorial</a> we will be generating a randomly generated simple QR-Code like PNG image.</p>

<p>Let&rsquo;s get to the main <code>func</code></p>

<pre><code class="language-Go">//main.go
package main

import (...)

func main() {
    // Seed the std random number generator
    rand.Seed(time.Now().UTC().UnixNano())

    // We will leave out creating the png image file since we
    // don't need the file

    // Set the bounds of the image basically 100px width / height
    imgRect := image.Rect(0, 0, 100, 100)
    // This creates the image in memory, and sets all pixels to a gray value.
    // And it sets the size based on the Rect we just created
    img := image.NewGray(imgRect)

    // Ok a lot going on here. Let's start creates a nil mask layer on the image
    // Tt takes the image we created in memory, and then the bounding Rect
    // Next we add a reference to a uniform color (white) over the mask
    // The image.ZP means the mask we are drawing starts at the 0,0 point
    // draw.Src refrences the source mask
    draw.Draw(img, img.Bounds(), &amp;image.Uniform{color.White}, image.ZP, draw.Src)

    // These nested loop reference the y,x coordinates.
    // 100 is reference to the image with / height in pixels
    // 10 is reference to the size of the random blocks to be generated
    for y := 0; y &lt; 100; y += 10 {
        for x := 0; x &lt; 100; x += 10 {
            // Here we create a color to be set as a black block
            fill := &amp;image.Uniform{color.Black}
            // rand.Intn(10) creates a random non-negative number between 0,10
            // Then checks if it's even
            if rand.Intn(10)%2 == 0 {
                fill = &amp;image.Uniform{color.White}
            }
            // This draw.Draw takes a new Rect that is 10px,10px and sets
            // color based on fill
            draw.Draw(img, image.Rect(x, y, x+10, y+10), fill, image.ZP, draw.Src)
        }
    }
}

</code></pre>

<p>Ok well we now have generated the image in memory now lets get to the fun stuff.</p>

<p>First we need to create a bytes buffer that we can write into and read out to encode into a PNG from the image we created. Then we will take that buffer as a byte slice and output it as a string.</p>

<pre><code class="language-Go">//main.go

...

func main() {
    ...
    for ... {...}

    // Here we allocate and create a buffer that can easily be
    // turned into a []byte
    out := new(bytes.Buffer)

    // We now encode the image we created to the buffer
    err := png.Encode(out, img)
    if err != nil {
        // Handle errors
    }

    // This now takes a []byte of the buffer and base64 encodes it to a string
    // Never needing to create the image file all done in memory
    base64Img := base64.StdEncoding.EncodeToString(out.Bytes())

    //And now you can see the magic happen.
    // Go ahead and run it then take the output and copy/paste it in your
    // browser's URL bar, and you'll see your image.
    fmt.Println(&quot;data:image/png;base64,&quot;, base64Img)
}

</code></pre>

<p><img src="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAAAAABVicqIAAAAt0lEQVR4nOzYsQqFMAyFYZW+/yvrZh0Opyk4JOHPdLm2fBBIk3YcNu7312n/UztmXB75J0BAQNYhK97XtA+1o0+6QECKI2O/un1nV7NAn3SBgBRHZJmryVxtUevo8SAgiZFPgfo+LbcE1/VJFwhIcWT4fj7Dz/zqjGCqBwFJh8geLz+LddGbf590gYAUR8KP8ft3e6Z6EJB0iHyr9108estnqgcBSYcsenz0PODlDgSkBPIEAAD//007Gs0nXd84AAAAAElFTkSuQmCC" alt="base64 Image" /></p>

<p>The image above was generated with this tutorial&hellip; Nerd cool right?</p>

<p>Again without gzipping it typically is larger than its binary counterpart, but does reduce HTTP requests.</p>

<p><strong>Check out the full source code on <a href="https://github.com/dtoebe/datauri-blog-post">GitHub</a></strong></p>

    </div>

    <footer>
        <ul class="stats">
    
        

        
        
            <li>
                
                
                    

                    

                    

                    
                        Category
                    
                
            </li>
        
    

    
    
        <li><a href='/categoriesgolang'>golang</a></li>
    
</ul>

    </footer>
</article>
<ul class="actions pagination">
    
        <li><a href="http://dtoebe.com/post/simple_markdown_editor_in_go-qml/"
                class="button big previous">Write a simple Markdown editor with Go-QML</a></li>
    

    
</ul>



    
        <article class="post">
            <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'dtoebe';
    var disqus_identifier = 'http:\/\/dtoebe.com\/post\/generating-datauri-images-with-go\/';
    var disqus_title = 'Generating Data URI Images with GoLang';
    var disqus_url = 'http:\/\/dtoebe.com\/post\/generating-datauri-images-with-go\/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </article>
    



            <section id="share-menu">
    <section id="social-share-nav">
        <ul class="links">
            <header>
                <h3>Share this post <i class="fa fa-smile-o"></i></h3>
            </header>
            


<li><a href="//twitter.com/share?url=http%3a%2f%2fdtoebe.com%2fpost%2fgenerating-datauri-images-with-go%2f&text=Generating%20Data%20URI%20Images%20with%20GoLang&via=dtoebe" target="_blank" class="share-btn twitter">
    <i class="fa fa-twitter"></i>
    <p>Twitter</p>
</a></li>


<li><a href="//plus.google.com/share?url=http%3a%2f%2fdtoebe.com%2fpost%2fgenerating-datauri-images-with-go%2f" target="_blank" class="share-btn google-plus">
    <i class="fa fa-google-plus"></i>
    <p>Google+</p>
</a></li>


<li><a href="//www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fdtoebe.com%2fpost%2fgenerating-datauri-images-with-go%2f" target="_blank" class="share-btn facebook">
    <i class="fa fa-facebook"></i>
    <p>Facebook</p>
</a></li>


<li><a href="//reddit.com/submit?url=http%3a%2f%2fdtoebe.com%2fpost%2fgenerating-datauri-images-with-go%2f&title=Generating%20Data%20URI%20Images%20with%20GoLang" target="_blank" class="share-btn reddit">
    <i class="fa fa-reddit-alien"></i>
    <p>Reddit</p>
</a></li>


<li><a href="//www.linkedin.com/shareArticle?url=http%3a%2f%2fdtoebe.com%2fpost%2fgenerating-datauri-images-with-go%2f&title=Generating%20Data%20URI%20Images%20with%20GoLang" target="_blank" class="share-btn linkedin">
    <i class="fa fa-linkedin"></i>
    <p>LinkedIn</p>
</a></li>


<li><a href="//www.stumbleupon.com/submit?url=http%3a%2f%2fdtoebe.com%2fpost%2fgenerating-datauri-images-with-go%2f&title=Generating%20Data%20URI%20Images%20with%20GoLang" target="_blank" class="share-btn stumbleupon">
    <i class="fa fa-stumbleupon"></i>
    <p>StumbleUpon</p>
</a></li>


<li><a href="mailto:?subject=Check out this post by Daniel%20Toebe&body=http%3a%2f%2fdtoebe.com%2fpost%2fgenerating-datauri-images-with-go%2f" target="_blank" class="share-btn email">
    <i class="fa fa-envelope"></i>
    <p>Email</p>
</a></li>

        </ul>
    </section>
</section>

        
    </div>
    
<section id="sidebar">

    
        <section id="intro">
            
            
                
                    <a href="/" class="logo"><img src="/images/self_small.jpg" alt="me!" /></a>
                
            
            
                <header>
                    <h2>dtoebe.com</h2>
                    <p>Just the ramblings of a passionate programmer and Linux lover</p>
                </header>
            
            <ul class="icons">
                
                    <li><a href="http://dtoebe.com/index.xml" type="application/rss+xml"
                        target="_blank" title="RSS" class="fa fa-rss"></a></li>
                
                
                    
<li><a href="//github.com/dtoebe" target="_blank" title="GitHub" class="fa fa-github"></a></li>



<li><a href="//bitbucket.com/dtoebe" target="_blank" title="Bitbucket" class="fa fa-bitbucket"></a></li>

































<li><a href="//linkedin.com/in/daniel-toebe-b1533327" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>





<li><a href="//stackoverflow.com/users/1371285/daniel-toebe" target="_blank" title="Stack Overflow" class="fa fa-stack-overflow"></a></li>



<li><a href="//reddit.com/user/dtoebe" target="_blank" title="Reddit" class="fa fa-reddit"></a></li>





<li><a href="//plus.google.com/+dtoebe" target="_blank" title="Google+" class="fa fa-google-plus"></a></li>





<li><a href="//twitter.com/dtoebe" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>



<li><a href="mailto:dtoebe@gmail.com" title="Email" class="fa fa-envelope"></a></li>


                
            </ul>
        </section>

    
        <section id="recent-posts">
            <ul class="posts">
                <header>
                    <h3>Recent Posts</h3>
                </header>
                
                    
                

                
                    
                

                
                    <li>
                        <article>
                            <header>
                                <h3><a href="http://dtoebe.com/post/generating-datauri-images-with-go/">Generating Data URI Images with GoLang</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2016-09-21'>
                                    September 21, 2016</time>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <h3><a href="http://dtoebe.com/post/simple_markdown_editor_in_go-qml/">Write a simple Markdown editor with Go-QML</a></h3>
                                
                                    
                                
                                <time class="published" datetime=
                                    '2016-05-16'>
                                    May 16, 2016</time>
                            </header>
                        </article>
                    </li>
                

                
                    <li>
                        <ul class="actions">
                            <li><a href=
                            
                                /post/
                            
                            class="button">View more posts</a></li>
                        </ul>
                    </li>
                
            </ul>
        </section>

    
    
    
    
        <section id="categories">
            <ul class="posts">
                <header>
                    <h3><a href="/categories/">Categories</a></h3>
                </header>

                
                    
                

                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/golang/">golang</a>
                                <span style="float:right;">2</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/qemu/">qemu</a>
                                <span style="float:right;">1</span>
                            </header>
                        </article>
                    </li>
                
                    <li>
                        <article>
                            <header>
                                <a href="/categories/qml/">qml</a>
                                <span style="float:right;">1</span>
                            </header>
                        </article>
                    </li>
                
            </ul>
        </section>
    

    
        
        <section id="twitter-feed">
            <a class="twitter-timeline" data-height="600" href="https://twitter.com/dtoebe">Tweets by dtoebe</a> 
            <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
        </section>
    
        <section id="footer">
            <ul class="icons">
                
                    <li><a href="http://dtoebe.com/index.xml" type="application/rss+xml"
                        target="_blank" title="RSS" class="fa fa-rss"></a></li>
                
                
                    
<li><a href="//github.com/dtoebe" target="_blank" title="GitHub" class="fa fa-github"></a></li>



<li><a href="//bitbucket.com/dtoebe" target="_blank" title="Bitbucket" class="fa fa-bitbucket"></a></li>

































<li><a href="//linkedin.com/in/daniel-toebe-b1533327" target="_blank" title="LinkedIn" class="fa fa-linkedin"></a></li>





<li><a href="//stackoverflow.com/users/1371285/daniel-toebe" target="_blank" title="Stack Overflow" class="fa fa-stack-overflow"></a></li>



<li><a href="//reddit.com/user/dtoebe" target="_blank" title="Reddit" class="fa fa-reddit"></a></li>





<li><a href="//plus.google.com/+dtoebe" target="_blank" title="Google+" class="fa fa-google-plus"></a></li>





<li><a href="//twitter.com/dtoebe" target="_blank" title="Twitter" class="fa fa-twitter"></a></li>



<li><a href="mailto:dtoebe@gmail.com" title="Email" class="fa fa-envelope"></a></li>


                
            </ul>

            <p class="copyright">&copy; dtoebe.com. Design: <a href="http://html5up.net" target="_blank">HTML5 UP</a>. Ported by <a href="//github.com/jpescador" target="_blank">Julio Pescador</a>. Powered by <a href="//gohugo.io" target="_blank">Hugo</a></p>
        </section>

</section>

            </div>
        <a id="back-to-top" href="#" class="fa fa-arrow-up fa-border fa-2x"></a>
        

        
        
            
        

        
        
            <script src="/js/jquery.min.js"></script>
            <script src="/js/skel.min.js"></script>
            <script src="/js/util.js"></script>
            <script src="/js/main.js"></script>
            <script src="/js/backToTop.js"></script>
            <script src="/js/highlight.pack.js"></script>
        

        

            
            <script>hljs.initHighlightingOnLoad();</script>
            
    </body>
</html>

